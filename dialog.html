<!DOCTYPE html>
<html>
<head>
    <title>Split work item</title>
    <script src="scripts/VSS.SDK.min.js"></script>
    <script src="http://ajax.aspnetcdn.com/ajax/jquery/jquery-1.9.0.js"></script>
    <link rel="stylesheet" type="text/css" href="css/coreStyles.css">
</head>
<body>
    <div class="dialog-header">
        <div class="dialog-description">Below are the incomplete items for this work item.  Split to continue them in your next sprint.</div>
        <div class="dialog-content">
        </div>
    </div>
    
    <script type="text/javascript">
        VSS.init({
            explicitNotifyLoaded: true,
            usePlatformScripts: true,
            usePlatformStyles: true
        });
         var registrationForm = (function() {
                var currentChildWorkItems;
                
                var parseChildWorkItems = (childWorkItems) => {
                    var ids = [];
                    for(var i = 0 ; i < childWorkItems.length; i++) {
                        var childWorkItem = childWorkItems[i];
                        ids.push(childWorkItem.id);
                        
                    }
                    return ids;
                }

                function buildChildDivs(childWorkItems) {
                    // Get form values
                    currentChildWorkItems = childWorkItems;
                    var $content = $(".dialog-content");

                    var $taskGrid = $("<div>").addClass("task-grid");

                    for(var i = 0; i < childWorkItems.length; i++) {

                        var child = childWorkItems[i];

                        var title = child.fields["System.Title"];
                        var $taskContainer = $("<div>").addClass("task-container").attr("id", i);
                        $taskContainer.append($("<div>").addClass("color-bar"));
                        $taskContainer.append("<label>" + title + "</label>");
                        
                        var $deleteIcon = $("<div>").addClass("delete-icon").attr("id", i);
                        
                        $deleteIcon.on("click", (e) => {
                            
                            var myIndex = $(e.currentTarget).attr("id")
                            
                            $(".task-grid .task-container#" + myIndex).hide();
                            currentChildWorkItems.splice(myIndex, 1);
                        });
                        
                        $taskContainer.append($deleteIcon);
                        
                        $taskGrid.append($taskContainer);
                    }
                    $content.append($taskGrid);
                }

                function setNoChildResults() {
                    var $content = $(".dialog-content");
                    $content.addClass("no-children");
                    $(".dialog-description").text("These are no children to be split from this work item.");
                }

                VSS.notifyLoadSucceeded();
                return {
                    buildChildDivs: function(childWorkItems) {
                        buildChildDivs(childWorkItems);
                    },
                    getIDs: function() {
                        return parseChildWorkItems(currentChildWorkItems);
                    },
                    setNoChildResults: setNoChildResults
                };
            })();

        // Register form object to be used accross this extension
        VSS.register("split-work-dialog", registrationForm);
    </script>
</body>
</html>